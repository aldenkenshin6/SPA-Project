@page "/customers/table"
@using Radzen
@using Radzen.Blazor
@using SPA1.Data
@using SPA1.Models
@using BCrypt.Net
@inject SpaContext _context
@inject NavigationManager Navigation

<h1 class="title">Super Admin Account Maker</h1>

@if (Users == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="container">
        <table class="custom-table">
            <thead>
                <tr>
                    <th>UserName</th>
                    <th>Password</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Gender</th>
                    <th>Contact Number</th>
                    <th>Availability</th>
                    <th>Commission Rate</th>
                    <th>Email</th>
                    <th>Role</th>
                    <th>Date Created</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var User in Users)
                {
                    <tr>
                        <td>@User.Username</td>
                        <td>@User.Password</td>
                        <td>@User.FirstName</td>
                        <td>@User.LastName</td>
                        <td>@User.Gender</td>
                        <td>@User.ContactNumber</td>
                        <td>@User.Availability</td>
                        <td>@User.CommisionRate</td>
                        <td>@User.Email</td>
                        <td>@User.Role</td>
                        <td>@User.DateCreated.ToString()</td>
                    </tr>
                }
            </tbody>
        </table>

        <RadzenButton Click=@(args => GoToLogin()) Text="Go Back to Login" ButtonStyle="ButtonStyle.Primary" Style="margin-bottom: 20px;" />

        <form class="form-container" action="#" method="POST">
            <h2>Create New Account</h2>

            <div class="form-group">
                <label>Username</label>
                <input type="text" @bind="Username" placeholder="Enter Username">
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" @bind="Password" placeholder="Enter Password">
            </div>

            <div class="form-group">
                <label>First Name</label>
                <input type="text" @bind="FirstName" placeholder="Enter First Name">
            </div>

            <div class="form-group">
                <label>Last Name</label>
                <input type="text" @bind="LastName" placeholder="Enter Last Name">
            </div>

            <div class="form-group">
                <label>Gender</label>
                <select @bind="Gender">
                    <option>-- Select Options --</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Contact Number</label>
                <input type="tel" @bind="Contact_Number" placeholder="Enter Contact Number">
            </div>

            <div class="form-group">
                <label>Availability</label>
                <input type="text" @bind="Availability" placeholder="Enter Availability">
            </div>

            <div class="form-group">
                <label>Commission Rate</label>
                <input type="number" @bind="Commission_Rate" step="0.01" placeholder="Enter Commission Rate">
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" @bind="Email" placeholder="Enter Email">
            </div>

            <div class="form-group">
                <label>Role</label>
                <select @bind="Role">
                    <option>-- Select Options --</option>
                    <option value="Admin">Admin</option>
                    <option value="Cashier">Cashier</option>
                    <option value="Staff">Staff</option>
                </select>
            </div>

            <button class="submit-btn" @onclick="Insert" type="button">Submit</button>

            <p class="message">@message</p>
        </form>
    </div>
}
@code {

    private string? Username;
    private string? Password;
    private string? FirstName;
    private string? LastName;
    private string? Gender;
    private string? Contact_Number;
    private string? Availability;
    private decimal Commission_Rate;
    private string? Email;
    private string? Role;
    private string? message;

    private async Task Insert()
    {
        try
        {
            var hashpassword = BCrypt.HashPassword(Password);
            var currentDate = DateOnly.FromDateTime(DateTime.Now);

            var user = new User
        {
            Username = Username,
            Password = hashpassword,
            FirstName = FirstName,
            LastName = LastName,
            Gender = Gender,
            ContactNumber = Contact_Number,
            Availability = Availability,
            CommisionRate = Commission_Rate,
            Email = Email,
            Role = Role,
            DateCreated = currentDate,
        };

            _context.Users.Add(user);
            await _context.SaveChangesAsync();

            message = "Successfuly: Insert HAHAHAH!";

            Users = _context.Users.ToList();


        }
    catch (Exception e)
    {
        message = $"NIGGA ERROR: {e.Message}";
    }
}


    List<User>? Users;

    protected override void OnInitialized()
    {
        Users = _context.Users.ToList();
    }

    void GoToLogin()
    {
        Navigation.NavigateTo("/auth/login");
    }
}
